# Задачи проекта

## Планирование
- [x] Зафиксировать архитектурный стек (Java фреймворк, БД, поисковый движок, хранилище медиа). (created 2026-01-17) (completed 2026-01-17: PostgreSQL, Elasticsearch, Redis, Kafka, локальное хранилище, Docker Compose, JWT+refresh)
- [x] Определить модель данных для товаров, пользователей, заказов, модерации и жалоб. (created 2026-01-17) (completed 2026-01-17: добавлен черновик модели данных)
- [x] Проработать поток модерации (первый товар продавца, жалобы, блокировки). (created 2026-01-17) (completed 2026-01-17: черновики, премодерация первого товара, жалобы от всех, блокировки на усмотрение модератора)
- [x] Уточнить требования к логистике (статусы, SLA, трекинг). (created 2026-01-17) (completed 2026-01-17: статусы доставки обязательны)
- [x] Уточнить требования к безопасности и требованиям резервного копирования. (created 2026-01-17) (completed 2026-01-17: RPO 15 минут, RTO 1 час)
- [x] Определить подход к уведомлениям (email/web) и их хранению. (created 2026-01-17) (completed 2026-01-17: список событий, формат коротких шаблонов)
- [x] Определить метрики продавца и источники данных (просмотры, позиция, конверсия). (created 2026-01-17) (completed 2026-01-17: уникальные просмотры, средняя позиция, конверсия = заказы/просмотры)
- [x] Определить границы микросервисов и владение данными. (created 2026-01-17) (completed 2026-01-17: сервисные границы и владельцы доменов добавлены в PLAN.md)
- [x] Сформировать перечень доменных событий и требования к EDA. (created 2026-01-17) (completed 2026-01-17: базовый список событий и EDA требования добавлены в PLAN.md)
- [x] Зафиксировать контрактную модель gRPC (protobuf) и версионирование. (created 2026-01-17) (completed 2026-01-17: правила версионирования gRPC добавлены в PLAN.md)
- [x] Определить стратегию согласованности (saga/outbox) и идемпотентность. (created 2026-01-17) (completed 2026-01-17: Outbox + Saga и идемпотентность зафиксированы в PLAN.md/DECISIONS.md)

## Реализация
- [x] Зафиксировать Java стек и инструменты сборки. (created 2026-01-17) (completed 2026-01-17: Spring Boot 3, Java 21, Gradle, JPA/Hibernate, Flyway)
- [x] Подготовить структуру репозитория по чистой архитектуре (backend: domain/application/adapters/infrastructure; frontend). (created 2026-01-17) (completed 2026-01-17: созданы каталоги и минимальные gradle файлы)
- [x] Настроить docker-compose для инфраструктуры (PostgreSQL, Elasticsearch, Redis, Kafka). (created 2026-01-17) (completed 2026-01-17: добавлен docker-compose.yml)
- [x] Реализовать базовую аутентификацию и роли (JWT + refresh). (created 2026-01-17) (completed 2026-01-17: сервис регистрации/логина/refresh, JWT фильтр, роли, email-верификация)
- [x] Настроить наблюдаемость (OpenTelemetry, Elasticsearch + Kibana для логов). (created 2026-01-17) (completed 2026-01-17: добавлены Kibana и OpenTelemetry Collector)
- [x] Реализовать каталог товаров и загрузку изображений с локальным хранилищем. (created 2026-01-17) (completed 2026-01-17: создание товара и загрузка изображений в локальное хранилище)
- [x] Реализовать поиск и автодополнение с индексацией. (created 2026-01-17) (completed 2026-01-17: Elasticsearch индекс, поиск с опечатками и подсказки)
- [x] Реализовать оформление заказов, оплату и статусы доставки. (created 2026-01-17) (completed 2026-01-17: создание заказа, платежи (stub YooKassa), статусы доставки)
- [x] Реализовать модерацию, жалобы и апелляции. (created 2026-01-17) (completed 2026-01-17: жалобы, решения модерации, блокировки и апелляции)
- [x] Реализовать уведомления (email/web). (created 2026-01-17) (completed 2026-01-17: добавлены доменная модель уведомлений, хранение, контроллер и email-логгер)
- [x] Реализовать метрики продавца и расчет показателей. (created 2026-01-17) (completed 2026-01-17: добавлены события просмотров/поиска, расчет метрик и API)
- [x] Перевести API на корректные HTTP методы (PUT/PATCH/DELETE). (created 2026-01-17) (completed 2026-01-17: обновлены PATCH для оплаты, статуса доставки, прочтения уведомлений и решения по апелляции)
- [x] Добавить восстановление пароля по email. (created 2026-01-17) (completed 2026-01-17: добавлены reset tokens и endpoints)
- [x] Реализовать отзыв всех активных refresh-токенов при смене/восстановлении пароля через версию токена. (created 2026-01-17) (completed 2026-01-17: token_version в users/refresh_tokens, проверка при refresh, revoke на reset/change)
- [x] Добавить таблицу refresh_tokens и аудит последнего входа пользователя. (created 2026-01-17) (completed 2026-01-17: расширены refresh_tokens и добавлен login_audit)
- [x] Сохранить user agent/устройство/локацию при логине для модерации. (created 2026-01-17) (completed 2026-01-17: сохраняются user agent/ip/device/browser, geoip будет асинхронно)
- [ ] Реализовать асинхронное обогащение GeoIP через Kafka (GeoLite2, best-effort). (created 2026-01-17)
- [ ] Добавить редактирование товара/черновика без повторной модерации. (created 2026-01-17)
- [ ] Добавить блок «Похожие товары» в карточке товара. (created 2026-01-17)
- [ ] Подготовить план декомпозиции монолита на микросервисы. (created 2026-01-17)
- [ ] Определить дизайн API Gateway и маршрутизацию публичного REST API. (created 2026-01-17)
- [ ] Описать границы Kafka событий и gRPC вызовов между сервисами. (created 2026-01-17)
